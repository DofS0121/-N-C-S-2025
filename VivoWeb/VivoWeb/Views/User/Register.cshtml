@model VivoWeb.Models.User
@{
    ViewBag.Title = "Đăng ký tài khoản";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="text-center text-primary mb-4">Đăng ký tài khoản</h2>

@using (Html.BeginForm("Register", "User", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()

    <div class="card p-4 shadow-sm bg-white rounded mx-auto" style="max-width: 600px;">
        <h4 class="text-center text-dark mb-3">Thông tin tài khoản</h4>
        <hr />

        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger">@ViewBag.Error</div>
        }

        <div class="mb-3">
            <label class="form-label">Tên đăng nhập</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                <input type="text" name="Username" class="form-control" placeholder="Nhập tên đăng nhập" required />
            </div>
            @if (ViewBag.UsernameExists != null)
            {
                <span class="text-danger">@ViewBag.UsernameExists</span>
            }
        </div>

        <div class="mb-3">
            <label class="form-label">Mật khẩu</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                <input type="password" name="PasswordHash" id="password" class="form-control" placeholder="Nhập mật khẩu" autocomplete="new-password" required />
                <span class="input-group-text" onclick="togglePassword()" style="cursor:pointer;">
                    <i class="bi bi-eye-fill" id="toggleEye"></i>
                </span>
            </div>
            @if (ViewBag.PasswordError != null)
            {
                <span class="text-danger">@ViewBag.PasswordError</span>
            }
        </div>

        <div class="mb-3">
            <label class="form-label">Họ và tên</label>
            <input type="text" name="FullName" class="form-control" placeholder="Nhập họ và tên" required />
        </div>

        <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="Email" class="form-control" placeholder="Nhập email" required />
            @if (ViewBag.EmailExists != null)
            {
                <span class="text-danger">@ViewBag.EmailExists</span>
            }
        </div>

        <div class="mb-3">
            <label class="form-label">Số điện thoại</label>
            <input type="text" name="Phone" class="form-control" placeholder="Nhập số điện thoại" required />
            @if (ViewBag.PhoneExists != null)
            {
                <span class="text-danger">@ViewBag.PhoneExists</span>
            }
        </div>

        <div class="mb-3 text-center">
            <img id="pictureUpload" src="~/images/default-avatar.png" class="img-thumbnail rounded-circle" style="width:150px; height:150px; object-fit:cover;" />
            <br />
            <input type="file" name="avatar" id="fileUpload" accept="image/*" class="form-control mt-2" />
            <small class="text-muted">Ảnh đại diện (jpg, jpeg, png; tối đa 2MB)</small>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary px-5">Đăng ký</button>
        </div>
    </div>
}

<div class="mt-3 text-center">
    @Html.ActionLink("Quay lại trang chủ", "Index", "Tour", null, new { @class = "btn btn-secondary" })
</div>

@section Scripts {
    <script>
        function togglePassword() {
            var passwordInput = document.getElementById("password");
            var toggleEye = document.getElementById("toggleEye");
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                toggleEye.classList.remove("bi-eye-fill");
                toggleEye.classList.add("bi-eye-slash-fill");
            } else {
                passwordInput.type = "password";
                toggleEye.classList.remove("bi-eye-slash-fill");
                toggleEye.classList.add("bi-eye-fill");
            }
        }

        document.getElementById("fileUpload").addEventListener("change", function (event) {
            var file = event.target.files[0];
            if (!file) return;

            if (file.size > 2 * 1024 * 1024) {
                alert("Kích thước file quá lớn! Vui lòng chọn ảnh dưới 2MB.");
                event.target.value = "";
                return;
            }

            var allowedTypes = ["image/jpeg", "image/jpg", "image/png"];
            if (!allowedTypes.includes(file.type)) {
                alert("Chỉ chấp nhận các định dạng JPG, JPEG và PNG!");
                event.target.value = "";
                return;
            }

            var reader = new FileReader();
            reader.onload = function () {
                document.getElementById("pictureUpload").src = reader.result;
            };
            reader.readAsDataURL(file);
        });
    </script>
}
