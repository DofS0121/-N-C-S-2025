@model VivoWeb.Models.PaymentViewModel
@{
    Layout = null;
    var minutes = 4;
}

<!DOCTYPE html>
<html>
<head>
    <title>Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

    <h2 class="text-center">🔐 Xác nhận Thanh toán</h2>
    <p id="countdown" class="text-danger fw-bold text-center"></p>

    @using (Html.BeginForm("Confirm", "Payment", FormMethod.Post))
    {
        <table class="table table-bordered mt-4">
            <tr><th>Người lớn</th><td>@Model.Adults</td><td>@Model.AdultPrice.ToString("N0") ₫</td></tr>
            <tr><th>Trẻ em</th><td>@Model.Children</td><td>@Model.ChildPrice.ToString("N0") ₫</td></tr>
            <tr><th>Em bé</th><td>@Model.Infants</td><td>@Model.InfantPrice.ToString("N0") ₫</td></tr>
            <tr class="fw-bold text-success"><th colspan="2">Tổng tiền</th><td>@Model.TotalAmount.ToString("N0") ₫</td></tr>
        </table>

        <div class="form-group">
            <label>Hình thức thanh toán</label>
            <select name="PaymentMethod" class="form-control" required>
                <option value="">-- Chọn --</option>
                <option value="Cash">Tiền mặt</option>
                <option value="BankTransfer">Chuyển khoản</option>
            </select>
        </div>

        <div class="form-group mt-2">
            <label>Tỷ lệ thanh toán</label>
            <select name="PaymentRate" class="form-control" required>
                <option value="100%">Thanh toán 100%</option>
                <option value="50%">Thanh toán 50%</option>
            </select>
        </div>

        <div class="mt-3">
            <button type="submit" class="btn btn-success">✅ Xác nhận Thanh toán</button>
            <a href="@Url.Action("Book", "Booking", new { tourId = Model.Booking.TourSchedule.TourId })" class="btn btn-secondary">Quay lại</a>
        </div>
    }

    <script>
        // Countdown 4 phút
        let seconds = @minutes * 60;
        const countdownEl = document.getElementById("countdown");

        function updateTimer() {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            countdownEl.innerText = `⏳ Thời gian còn lại: ${min}:${sec.toString().padStart(2, "0")}`;
            if (seconds === 0) {
                alert("Hết thời gian thanh toán!");
                window.location.href = '@Url.Action("Index", "Tour")';
            }
            seconds--;
        }

        setInterval(updateTimer, 1000);
    </script>
</body>
</html>
